{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",
	"scopeName": "source.many",
	"name": "RunMany",
	"fileTypes": [".many", ".runmany"],
	"patterns": [
		{ "include": "#start" },
		{ "include": "#stop" },
		{ "include": "#comment" },
		{ "include": "#section" },
		{ "include": "invalid-headerTODO" }
	],
	"repository": {
		"start": {
			"name": "meta.start.many",
			"match": "^(START)\\s*(:)\\s*$",
			"captures": {
				"1": { "name": "keyword.control.definition.start.many" },
				"2": { "name": "punctuation.definition.start.many" }
			}
		},
		"stop": {
			"name": "meta.stop.many",
			"contentName": "comment.block.stop.many",
			"begin": "^(STOP)\\s*(\\.)\\s*$",
			"beginCaptures": {
				"1": { "name": "keyword.control.definition.stop.many" },
				"2": { "name": "punctuation.definition.stop.many" }
			},
			"while": ""
		},
		"comment": {
			"name": "comment.line.many",
			"match": "^\\s*(%%).*$",
			"captures": {
				"1": { "name": "punctuation.definition.comment.many" }
			}
		},
		"invalid-headerTODO": {
			"name": "invalid.illegal.unrecognized-header.many",
			"match": "^(?: {1,3}\\t?(?!%%%))?\\S.*$"
		},
		"section": {
			"name": "string.meta.section.many",
			"begin": "^(?=\\S)(?=(?!(?:!!\\s*)?(?:[!@]\\s*)?Also\\s*:)[^:]*:)",
			"while": "^(?=(\\s*%%.*$)| {4}|\\t|\\s*$|(?:[!@]\\s*)?Also\\s*:|End\\s*\\.)",
			"whileCaptures": { "1": { "patterns": [{ "include": "#comment" }] } },
			"patterns": [{ "include": "#disabled-section" }]
		},
		"disabled-section": {
			"name": "support.function.section.disabled.many",
			"begin": "^(!!)",
			"while": "",
			"beginCaptures": { "1": { "name": "punctuation.definition.disabled-section.many" } }
		},

		"settings-section": {
			"name": "meta.TO-NAME.block.json",
			"begin": "^(?=\\S)(?:@@)?\\s*[!@]?\\s*Settings\\s*:",
			"end": "(^End\\s*\\.)(?=\\s*(?:%%%.*)?$)|(?=STOP\\s*\\.\\s*(?:%%%.*)?$)|(?=^(?=\\S)(?![!@]?\\s*Also\\s*:)[^:]*:)",
			"patterns": [{ "include": "#disabled-settings-snippet" }, { "include": "#settings-snippet" }]
		},

		"disabled-settings-snippet": {
			"name": "support.function.TO-NAME.snippet.disabled.settings.many",
			"begin": "(?<=^(?:@@)?\\s*!\\s*Settings\\s*:)|^!\\s*Also\\s*:",
			"end": "(?=^End\\s*\\.\\s*(?:%%%.*)?$)|(?=STOP\\s*\\.\\s*(?:%%%.*)?$)|(?=^(?=\\S)[^:]*:)",
			"patterns": [{ "include": "#comment" }, { "include": "#invalid-header" }]
		},

		"settings-snippet": {
			"name": "meta.numeric.TO-NAME.snippet.settings.many",
			"begin": "(?<=^(?:@@)?\\s*[!@]?\\s*Settings\\s*:)|^(?=\\S)[!@]?\\s*(Also)\\s*:",
			"beginCaptures": {
				"1": { "name": "keyword.control.also" }
			},
			"while": ".*",
			"end": "(?=^End\\s*\\.\\s*(?:%%%.*)?$)|(?=STOP\\s*\\.\\s*(?:%%%.*)?$)|(?=^(?=\\S)[^:]*:)",
			"patterns": [{ "include": "#comment" }, { "include": "#invalid-header" }, { "include": "source.json" }]
		},

		"after-settings-json": {
			"name": "invalid.illegal.expected-end-of-json.many",
			"begin": "(?<=\\})",
			"while": ""
		},

		"language-list": {
			"name": "meta.language-list.many",
			"patterns": [
				{ "name": "entity.name.type.language-name.many", "match": "[^,:]+" },
				{ "name": "punctuation.separator.language-list.many", "match": "," }
			]
		},
		"input-language-list": {
			"name": "meta.input-language-list.many",
			"patterns": [
				{ "name": "variable.other.constant.input-language-name.many", "match": "[^,:]+" },
				{ "name": "punctuation.separator.input-language-list.many", "match": "," }
			]
		},

		"also-header": {
			"name": "meta.also-header.many",
			"match": "^[!@]?(Also)\\s*(:)",
			"captures": {
				"1": { "name": "keyword.control.also.many" },
				"2": { "name": "punctuation.definition.header.end.many" }
			}
		},
		"input-also-header": {
			"name": "meta.input-also-header.many",
			"match": "^(Also)\\s*(:)",
			"captures": {
				"1": { "name": "storage.section.input-also.many" },
				"2": { "name": "punctuation.definition.header.end.many" }
			}
		},

		"disabled-also-section": {
			"name": "comment.block.also-section.disabled.many",
			"begin": "^(!)\\s*Also\\s*:",
			"beginCaptures": { "1": { "name": "punctuation.definition.disabled.begin.many" } },
			"while": "(^%.*$)|^(?= {4}|\\t|\\s*$)",
			"whileCaptures": { "1": { "patterns": [{ "include": "#leading-comment" }] } }
		},

		"argv-section-list": {
			"name": "meta.section-list.input.argv.many",
			"begin": "^(Argv)\\s*(?:\\b(for)\\b([^:]*))?(:)",
			"beginCaptures": {
				"1": { "name": "storage.section.argv.many" },
				"2": { "name": "storage.section.argv-for.many" },
				"3": { "patterns": [{ "include": "#input-language-list" }] },
				"4": { "name": "punctuation.definition.header.end.many" }
			},
			"while": "^(?=%| {4}|\\t|\\s*$|(?:!\\s*)?Also\\s*:)",
			"patterns": [
				{ "include": "#disabled-also-section" },
				{ "include": "#input-also-header" },
				{ "include": "#argv-block" }
			]
		},
		"argv-block": {
			"name": "string.unquoted.block.argv.many",
			"begin": "",
			"while": "(^%.*$)|^(?= {4}|\\t|\\s*$)",
			"whileCaptures": { "1": { "patterns": [{ "include": "#leading-comment" }] } }
		},

		"stdin-section-list": {
			"name": "meta.section-list.input.stdin.many",
			"begin": "^(Stdin)\\s*(?:\\b(for)\\b([^:]*))?(:)",
			"beginCaptures": {
				"1": { "name": "storage.section.stdin.many" },
				"2": { "name": "storage.section.stdin-for.many" },
				"3": { "patterns": [{ "include": "#input-language-list" }] },
				"4": { "name": "punctuation.definition.header.end.many" }
			},
			"while": "^(?=%| {4}|\\t|\\s*$|(?:!\\s*)?Also\\s*:)",
			"patterns": [
				{ "include": "#disabled-also-section" },
				{ "include": "#input-also-header" },
				{ "include": "#stdin-block" }
			]
		},
		"stdin-block": {
			"name": "string.unquoted.block.stdin.many",
			"begin": "",
			"while": "(^%.*$)|^(?= {4}|\\t|\\s*$)",
			"whileCaptures": { "1": { "patterns": [{ "include": "#leading-comment" }] } }
		},

		"unknown-section-list": {
			"name": "meta.section-list.code.unknown.many",
			"begin": "^(?=\\S)(?!Also)([^:]*)(:)",
			"beginCaptures": {
				"1": { "patterns": [{ "include": "#language-list" }] },
				"2": { "name": "punctuation.definition.header.end.many" }
			},
			"while": "^(?=%| {4}|\\t|\\s*$|(?:!\\s*)?Also\\s*:)",
			"patterns": [
				{ "include": "#disabled-also-section" },
				{ "include": "#also-header" },
				{ "include": "#unknown-block" }
			]
		},
		"unknown-block": {
			"name": "meta.embedded.block.unknown",
			"begin": "",
			"while": "(^%.*$)|^(?= {4}|\\t|\\s*$)",
			"whileCaptures": { "1": { "patterns": [{ "include": "#leading-comment" }] } }
		},

		"python-section-list": {
			"name": "meta.section-list.code.python.many",
			"begin": "(?i)^(?=Python\\s*[,:])([^:]*)(:)",
			"beginCaptures": {
				"1": {
					"patterns": [
						{
							"include": "#language-list"
						}
					]
				},
				"2": {
					"name": "punctuation.definition.header.end.many"
				}
			},
			"while": "^(?=%| {4}|\\t|\\s*$|(?:!\\s*)?Also\\s*:)",
			"patterns": [
				{
					"include": "#disabled-also-section"
				},
				{
					"include": "#also-header"
				},
				{
					"include": "#python-block"
				}
			]
		},
		"python-block": {
			"name": "meta.embedded.block.python",
			"begin": "",
			"while": "(^%.*$)|^(?=.*(%%%.*$))|^(?= {4}|\\t|\\s*$)",
			"whileCaptures": {
				"1": {
					"patterns": [
						{
							"include": "#leading-comment"
						}
					]
				}
			},
			"patterns": [
				{
					"include": "#inline-comment"
				},
				{
					"include": "source.python"
				}
			]
		}
	}
}
